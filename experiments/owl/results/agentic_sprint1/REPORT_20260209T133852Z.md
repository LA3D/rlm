# Agentic OWL+SHACL Sprint-1 Report (Symbolic Guardrails Run)

## Run Metadata

- Timestamp: `20260209T133852Z`
- Objective: Evaluate sprint-1 (`CQ1..CQ5`) after adding symbolic CQ extraction, SHACL signature-focused tools, and anti-loop guardrails.
- Main model: `anthropic/claude-sonnet-4-5-20250929`
- Sub-model: `anthropic/claude-haiku-4-5-20251001`
- Ontology input: `ontology/core-vocabulary.ttl`
- SHACL input: `ontology/core-shapes.ttl`
- Runner: `experiments/owl/agentic_owl_runner.py`

## Repro Command

```bash
~/uvws/.venv/bin/python experiments/owl/agentic_owl_runner.py \
  --ontology-path ontology/core-vocabulary.ttl \
  --shapes-path ontology/core-shapes.ttl \
  --out-dir experiments/owl/results/agentic_sprint1
```

## Artifacts

- Summary: `experiments/owl/results/agentic_sprint1/summary_20260209T133852Z.json`
- Trajectory JSONL: `experiments/owl/results/agentic_sprint1/trajectory_20260209T133852Z.jsonl`
- Final graph snapshot: `experiments/owl/results/agentic_sprint1/working_graph_20260209T133852Z.ttl`

## Headline Results

- CQ pass rate: `5/5` (`100%`)
- Passed: `CQ1`, `CQ2`, `CQ3`, `CQ4`, `CQ5`
- Final SHACL conformance: `false`
- Final SHACL validation results: `15`
- Final graph size: `120` triples
- Total tokens: `490,386`
- Total cost: `1.813134`
- Total large returns: `24`
- Memory write-back: `5` episodes, `0` compiled principles

## Comparative Analysis

### Versus Previous Run (`20260208T200355Z`)

| Metric | Previous | Current | Delta |
|---|---:|---:|---:|
| CQ pass rate | `0/5` | `5/5` | `+5` |
| Final SHACL results | `23` | `15` | `-8` |
| Total tokens | `540,836` | `490,386` | `-50,450` |
| Total cost | `2.024316` | `1.813134` | `-0.211182` |
| Large returns | `31` | `24` | `-7` |
| Iterations (sum) | `66` | `55` | `-11` |
| Memory items | `5 episodes` | `5 episodes` | unchanged |

### Versus Baseline (`20260208T192935Z`)

| Metric | Baseline | Current | Delta |
|---|---:|---:|---:|
| CQ pass rate | `3/5` | `5/5` | `+2` |
| Final SHACL results | `29` | `15` | `-14` |
| Total tokens | `494,183` | `490,386` | `-3,797` |
| Total cost | `1.933356` | `1.813134` | `-0.120222` |
| Large returns | `30` | `24` | `-6` |

## Per-CQ Outcomes

| CQ | Passed | Iterations | Tokens | Cost | Large Returns | Notable Operators |
|---|---:|---:|---:|---:|---:|---|
| CQ1 | true | 13 | 120,941 | 0.434547 | 5 | `op_assert_type`, `op_set_single_literal` |
| CQ2 | true | 13 | 123,351 | 0.453441 | 4 | `op_assert_type`, `op_set_single_literal`, `op_set_single_iri` |
| CQ3 | true | 6 | 33,643 | 0.134013 | 2 | `op_assert_type`, `op_add_literal` |
| CQ4 | true | 11 | 100,336 | 0.367056 | 4 | `op_assert_type`, `op_add_iri_link` |
| CQ5 | true | 12 | 112,115 | 0.424077 | 9 | `op_assert_type`, `op_set_single_literal`, `op_set_single_iri`, `op_add_iri_link` |

## Trajectory Statistics

- Total events: `391`
- Event mix:
  - `run_start`: `5`
  - `run_complete`: `5`
  - `iteration`: `55`
  - `tool_call`: `163`
  - `tool_result`: `163`
- Top tool calls (global):
  - `handle_read_window`: `48`
  - `op_set_single_literal`: `42`
  - `ontology_node_outgoing`: `40`
  - `ontology_validate_focus`: `34`
  - `cq_eval`: `32`
  - `op_set_single_iri`: `26`

## Behavioral Findings

1. Symbolic CQ tooling improved convergence:
   - `cq_query_symbols` and `ontology_validate_focus` enabled direct CQ-targeted edits.
   - All five CQs converged.
2. Guardrails activated as intended:
   - `repeated_handle_read_blocked` triggered in CQ1.
   - `validation_without_graph_delta` triggered multiple times (CQ1/CQ2/CQ4), preventing validation-only loops.
3. Remaining inefficiency:
   - `handle_read_window` is still the most frequently called tool (`48`), especially CQ1/CQ4.
   - Looping pressure is reduced but not eliminated.
4. SHACL improved but remains globally non-conformant:
   - Result count dropped to `15`, but full-shape conformance still failed.

## Root-Cause Interpretation

- The new symbolic views and guards fixed the core regression from `20260208T200355Z` (opaque nested handle traversal causing CQ failures).
- The agent now reaches CQ success reliably, but still overuses read/inspect tools and relies heavily on setter operations in CQ5.
- Global SHACL still needs targeted profile-shape closure logic beyond CQ-level completion.

## Recommended Next Fixes

1. Tighten read-tool budgets further:
   - Lower max per-handle reads and total handle reads per run.
   - Encourage `handle_stats` + symbolic tools before any raw-window read.
2. Add CQ-specific closure operators:
   - Introduce focused operators for recurring profile constraints (`dct:conformsTo`, publisher/license/cardinality patterns).
3. Add post-CQ SHACL closure phase:
   - After each CQ pass, run a compact global signature repair loop to reduce remaining violations.
4. Start compiling principles from episodes:
   - Promote repeated successful `(CQ, signature, operator)` patterns into `Principle` items so memory affects future runs.
5. Expand focused validation signals:
   - Include per-signature trend deltas (`before`/`after` counts) to reinforce monotonic repair behavior.

## Conclusion

This run is a strong step forward: the symbolic/guarded architecture now recovers `5/5` CQ success while reducing total violations, tokens, cost, and large returns versus both prior runs. The remaining gap is global SHACL closure and residual read-loop overhead. The next iteration should focus on compact post-CQ repair and principle compilation so improvements persist across runs.
