# PROV Ontology Agent Guide

## Overview
The PROV ontology is a W3C standard designed to represent and exchange provenance information - the origins, history, and lineage of data and processes. It provides a formal vocabulary centered around three core classes (Entity, Activity, Agent) and their relationships to capture how entities were generated, what activities produced them, and which agents were responsible, enabling comprehensive tracking of data derivation and transformation chains. The ontology supports both simple direct relationships and detailed qualified patterns, making it suitable for applications ranging from scientific data management to digital forensics where understanding "where data came from" and "how it was created" is crucial.

## Core Classes
# PROV Core Classes: Entity, Activity, Agent

## Entity
**What it represents:** Things that exist or existed - data, documents, physical objects, or conceptual items that can be acted upon or produced.

**When to use:**
- Input/output data files
- Database records
- Reports, documents, images
- Physical samples or specimens
- Software versions
- Intermediate results

**Example:** A CSV dataset, a research paper, a blood sample, a trained ML model

## Activity
**What it represents:** Processes or actions that occur over time and act upon or produce entities.

**When to use:**
- Data processing steps
- Experiments or analyses
- Software executions
- Manual procedures
- Transformations or computations

**Example:** Running a data cleaning script, conducting a survey, training a neural network, peer review process

## Agent
**What it represents:** Entities that bear responsibility for activities - people, organizations, or software that can act.

**When to use:**
- Researchers, analysts, operators
- Organizations, departments, institutions  
- Software systems, algorithms, tools
- Automated processes with decision-making capability

**Example:** A data scientist, a research lab, a Python script, an AI system

## Key Relationships

```
Agent --wasAssociatedWith--> Activity --used--> Entity
                                   |
                                   v
                            --generated--> Entity
```

**Core pattern:** Agents perform Activities that use input Entities and generate output Entities.

**Practical tip:** Start by identifying your activities (what happened), then determine what entities were involved (inputs/outputs), and finally who/what was responsible (agents).

## Key Properties
Here are the 6 most fundamental PROV properties and their explanations:

## 1. **generated**
- **Relationship**: Links an activity to the entity it creates/produces
- **Usage pattern**: Activity → Entity
- **When to use**: When you need to show what an activity produced
- **Example**: `analysis_process generated results.csv`

## 2. **used**
- **Relationship**: Links an activity to the entity it consumes/reads as input
- **Usage pattern**: Activity → Entity  
- **When to use**: When documenting what inputs an activity required
- **Example**: `analysis_process used raw_data.csv`

## 3. **wasGeneratedBy**
- **Relationship**: Links an entity back to the activity that created it (inverse of generated)
- **Usage pattern**: Entity → Activity
- **When to use**: When starting from an entity and wanting to trace back to its creation
- **Example**: `results.csv wasGeneratedBy analysis_process`

## 4. **wasAttributedTo**
- **Relationship**: Links an entity to the agent (person/organization/software) responsible for it
- **Usage pattern**: Entity → Agent
- **When to use**: When establishing responsibility, authorship, or ownership
- **Example**: `research_paper wasAttributedTo dr_smith`

## 5. **wasDerivedFrom**
- **Relationship**: Shows that one entity was created using/transforming another entity
- **Usage pattern**: Entity → Entity
- **When to use**: When tracking data lineage or showing entity-to-entity relationships without specifying the intermediate activity
- **Example**: `summary_report wasDerivedFrom raw_dataset`

## 6. **wasAssociatedWith**
- **Relationship**: Links an activity to the agent that performed or was responsible for it
- **Usage pattern**: Activity → Agent
- **When to use**: When documenting who/what executed an activity
- **Example**: `data_analysis wasAssociatedWith researcher_alice`

These six properties form the core of most provenance graphs, allowing you to trace the flow from agents through activities to entities and their relationships.

## Query Patterns
Here are 5 practical SPARQL query examples for the PROV ontology:

## 1. Find all entities generated by a specific activity

```sparql
PREFIX prov: <http://www.w3.org/ns/prov#>

SELECT ?entity ?entityLabel
WHERE {
    ?entity prov:wasGeneratedBy <http://example.org/activity/data-analysis-2024> .
    OPTIONAL { ?entity rdfs:label ?entityLabel }
}
```

## 2. Find who was responsible for creating an entity

```sparql
PREFIX prov: <http://www.w3.org/ns/prov#>

SELECT ?agent ?agentName ?activity
WHERE {
    <http://example.org/entity/research-report> prov:wasGeneratedBy ?activity .
    ?activity prov:wasAssociatedWith ?agent .
    OPTIONAL { ?agent prov:label ?agentName }
}
```

## 3. Find the derivation chain of an entity

```sparql
PREFIX prov: <http://www.w3.org/ns/prov#>

SELECT ?derivedEntity ?sourceEntity ?derivationType
WHERE {
    <http://example.org/entity/final-dataset> prov:wasDerivedFrom+ ?sourceEntity .
    ?derivedEntity prov:wasDerivedFrom ?sourceEntity .
    
    # Optional: Get specific derivation type
    OPTIONAL {
        ?derivedEntity prov:wasRevisionOf ?sourceEntity .
        BIND("revision" AS ?derivationType)
    }
    OPTIONAL {
        ?derivedEntity prov:wasQuotedFrom ?sourceEntity .
        BIND("quotation" AS ?derivationType)
    }
}
ORDER BY ?derivedEntity
```

## 4. Find all activities an agent was associated with

```sparql
PREFIX prov: <http://www.w3.org/ns/prov#>

SELECT ?activity ?activityLabel ?role ?startTime ?endTime
WHERE {
    ?activity prov:wasAssociatedWith <http://example.org/agent/researcher-smith> .
    
    OPTIONAL { ?activity rdfs:label ?activityLabel }
    OPTIONAL { 
        ?activity prov:qualifiedAssociation ?assoc .
        ?assoc prov:agent <http://example.org/agent/researcher-smith> ;
               prov:hadRole ?role .
    }
    OPTIONAL { ?activity prov:startedAtTime ?startTime }
    OPTIONAL { ?activity prov:endedAtTime ?endTime }
}
ORDER BY DESC(?startTime)
```

## 5. Find entities that used a specific input

```sparql
PREFIX prov: <http://www.w3.org/ns/prov#>

SELECT ?entity ?activity ?usageTime
WHERE {
    ?activity prov:used <http://example.org/entity/raw-sensor-data> .
    ?entity prov:wasGeneratedBy ?activity .
    
    # Optional: Get usage details
    OPTIONAL {
        ?activity prov:qualifiedUsage ?usage .
        ?usage prov:entity <http://example.org/entity/raw-sensor-data> ;
               prov:atTime ?usageTime .
    }
}
ORDER BY ?usageTime
```

## Bonus: Complex provenance query combining multiple patterns

```sparql
PREFIX prov: <http://www.w3.org/ns/prov#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?finalEntity ?intermediateEntity ?originalInput ?responsibleAgent ?activityTime
WHERE {
    # Find entities derived from original input
    ?finalEntity prov:wasDerivedFrom+ ?originalInput .
    
    # Find intermediate derivation step
    ?finalEntity prov:wasDerivedFrom ?intermediateEntity .
    ?intermediateEntity prov:wasDerivedFrom+ ?originalInput .
    
    # Find the activity that generated the final entity
    ?finalEntity prov:wasGeneratedBy ?activity .
    
    # Find who was responsible
    ?activity prov:wasAssociatedWith ?responsibleAgent .
    
    # Get timing information
    OPTIONAL { ?activity prov:endedAtTime ?activityTime }
    
    # Filter for specific input type
    FILTER(?originalInput = <http://example.org/entity/survey-responses>)
}
ORDER BY ?activityTime
```

These queries demonstrate common provenance patterns:
- **Query 1**: Basic generation relationship
- **Query 2**: Attribution through activities  
- **Query 3**: Transitive derivation chains using `+` operator
- **Query 4**: Agent-activity associations with roles and timing
- **Query 5**: Usage relationships with qualified associations
- **Bonus**: Complex multi-step provenance tracking

Each query uses proper PROV namespace and includes optional clauses for additional metadata that might not always be present in the data.

## Important Considerations
# Important Considerations

## When to Use Qualified vs Simple Properties

**Use Simple Properties When:**
- Basic relationships are sufficient (e.g., `prov:wasGeneratedBy`, `prov:used`)
- No additional metadata is needed about the relationship itself
- Creating lightweight, straightforward provenance traces

**Use Qualified Properties When:**
- You need to attach metadata to relationships (roles, time, location, etc.)
- Multiple agents/entities participate in the same relationship type
- Describing complex scenarios requiring nuanced attribution

```turtle
# Simple: Basic usage
:report prov:wasGeneratedBy :analysis .

# Qualified: With role and timing
:report prov:qualifiedGeneration [
    a prov:Generation ;
    prov:activity :analysis ;
    prov:atTime "2024-01-15T10:30:00Z"^^xsd:dateTime ;
    prov:hadRole :FinalOutput
] .
```

## Common Modeling Pitfalls

**1. Overusing Qualified Properties**
- Don't qualify every relationship; use simple properties when metadata isn't needed
- Qualified patterns add complexity—ensure the benefit justifies the cost

**2. Inconsistent Temporal Modeling**
- Activities should have `prov:startedAtTime` and `prov:endedAtTime`
- Generation/usage times should fall within activity timeframes
- Use consistent timezone handling

**3. Confusing Entity Versions**
- Model document revisions as separate entities, not attributes
- Use `prov:wasRevisionOf` for version relationships
- Don't conflate the abstract document with specific versions

**4. Agent Role Confusion**
- Distinguish between `prov:wasAssociatedWith` (activity participation) and `prov:wasAttributedTo` (entity responsibility)
- Use appropriate agent types: Person, Organization, SoftwareAgent

## Best Practices for PROV Usage

**1. Start Simple, Add Complexity Gradually**
- Begin with core Entity-Activity-Agent relationships
- Add qualification only when needed for your use case
- Incrementally enhance with temporal and role information

**2. Maintain Consistency**
- Establish naming conventions for activities and roles
- Use consistent URI patterns across your provenance graph
- Document your modeling decisions and patterns

**3. Leverage Bundles for Complex Scenarios**
- Use `prov:Bundle` to group related provenance statements
- Helpful for versioning provenance itself or handling multiple perspectives
- Essential for distributed provenance scenarios

**4. Validate Your Model**
- Check temporal consistency (activity times vs. generation/usage times)
- Ensure proper typing of entities, activities, and agents
- Verify that qualified properties reference appropriate classes

## Key Gotchas

**1. Temporal Constraints**
```turtle
# WRONG: Generation before activity starts
:activity prov:startedAtTime "2024-01-15T10:00:00Z"^^xsd:dateTime .
:entity prov:wasGeneratedBy :activity ;
        prov:generatedAtTime "2024-01-15T09:30:00Z"^^xsd:dateTime .
```

**2. Circular Dependencies**
- Avoid cycles in derivation chains unless representing iterative processes
- Be careful with `prov:wasInformedBy` to prevent activity loops

**3. Mixing Abstraction Levels**
- Don't mix high-level business processes with low-level system operations in the same provenance chain
- Maintain consistent granularity within related provenance statements

**4. Collection Modeling**
- Use `prov:Collection` for sets of entities, not for representing structured data
- Remember that collections are entities and follow entity provenance rules
- Consider whether you need provenance of the collection or its members

**5. Namespace Management**
- Always declare PROV namespace: `@prefix prov: <http://www.w3.org/ns/prov#> .`
- Be consistent with custom namespace prefixes
- Avoid conflicts with PROV's reserved terms

**6. Tool Compatibility**
- Not all PROV tools support the complete specification
- Test your provenance graphs with your intended consumption tools
- Consider using PROV-N or PROV-JSON for better tool interoperability

## Quick Reference
# PROV Ontology Quick Reference

## Namespace
```turtle
@prefix prov: <http://www.w3.org/ns/prov#> .
```

## Core Classes
- **Entity** - Physical/digital/conceptual things (datasets, documents, people)
- **Activity** - Actions that occur over time (processes, computations, events)  
- **Agent** - Responsible parties (persons, organizations, software)

## Essential Properties
```
Agent ──wasAssociatedWith──> Activity
Activity ──used──> Entity
Activity ──generated──> Entity
Entity ──wasDerivedFrom──> Entity
Entity ──wasAttributedTo──> Agent
Entity ──wasGeneratedBy──> Activity
```

## Common Patterns

### Basic Flow
```
Agent ──wasAssociatedWith──> Activity ──used──> Entity₁
                                │
                                └──generated──> Entity₂
```

### Attribution Chain
```
Entity₁ ──wasDerivedFrom──> Entity₂ ──wasAttributedTo──> Agent
```

### Full Provenance
```
Agent ──wasAssociatedWith──> Activity ──used──> InputEntity
                                │
                                └──generated──> OutputEntity
                                                    │
                                                    └──wasAttributedTo──> Agent
```

## Quick Tips
- Use `prov:startedAtTime` / `prov:endedAtTime` for Activity timing
- Use `prov:wasInformedBy` to link Activities
- Use `prov:actedOnBehalfOf` for Agent delegation
