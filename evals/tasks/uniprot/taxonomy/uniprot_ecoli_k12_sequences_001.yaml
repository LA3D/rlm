# Eval Task: UniProt Taxonomy - E. coli K12 strains and sequences
# Source exemplar: ontology/uniprot/examples/UniProt/3_entry_sequences_organism.ttl

task:
  id: "uniprot_ecoli_k12_sequences_001"
  category: "uniprot/taxonomy"
  difficulty: "medium"

  query: "Select UniProtKB proteins (and their amino acid sequences) for E. coli K12 and all its strains."

  context:
    ontologies:
      - name: uniprot_core
        source: ontology/uniprot/core.ttl
    sparql:
      endpoint: "https://sparql.uniprot.org/sparql/"
      prefixes: "ontology/uniprot/examples/prefixes.ttl"
      exemplar: "ontology/uniprot/examples/UniProt/3_entry_sequences_organism.ttl"

  # Expected patterns from exemplar (for LLM judge context, not strict requirements)
  exemplar_patterns:
    - "PREFIX taxon:"
    - "PREFIX up:"
    - "up:organism"
    - "rdfs:subClassOf taxon:83333"  # Note: Materialized - do NOT use rdfs:subClassOf+
    - "up:sequence"
    - "rdf:value"

  graders:
    - type: convergence
      max_iterations: 16  # Natural: 10-11 when successful, up to 15+ when struggling
    - type: outcome_verification
      # Verify results are E. coli K12 proteins with sequences
      result_type: "present"
      min_results: 3
      required_fields: ["protein", "sequence"]
      verification_patterns:
        # Check proteins are UniProt URIs
        - field: "protein"
          pattern: "uniprot.org/uniprot/"
          matches: "all"
        # Check sequences are amino acids (contain letters A-Z)
        - field: "sequence"
          pattern: "[A-Z]{10,}"
          matches: "all"
    - type: llm_judge
      # LLM provides semantic correctness evaluation
      # CRITICAL: This task requires NON-transitive hierarchy (materialized)
      use_exemplar_patterns: true
      strict: false
    - type: tool_called
      required: ["sparql_query"]

  trials: 3

